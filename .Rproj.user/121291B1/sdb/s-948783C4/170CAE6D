{
    "contents" : "#probit\nlibrary(mblm)\nlibrary(Kendall)\nlist_substs <- function(graph_data, min_reversals){\n    uniq <- unique(graph_data$site_node)\n    uniq <- as.character(uniq)\n    list <- lapply(uniq, function(e) {\n            if (length(graph_data$site_node[graph_data$site_node == e]) >= min_reversals) {\n                return (e)\n            }\n            else {\n                return (NA);\n            }\n            })\n    list <- list[!is.na(list)]\n    list <-as.character(list)\n}\n\n\nkendall_stats <-function (graph_data, substs_list){\n    coeffs <- lapply(substs_list, function(e) {\n              node_data <- graph_data[graph_data$site_node == e,]\n              x <- node_data$radius\n              y <- node_data$density\n              ts <- mblm(y~x)\n              ts[[\"coefficients\"]][\"x\"]}\n              )\n    ts_coeffs <- sapply(coeffs, function(e) e)\n    mk <- lapply (substs_list, function(e) {node_data <- graph_data[graph_data$site_node == e,]\n          MannKendall(node_data$density)}\n          )\n    mk_pvalue <- sapply(mk, function(e) e[2]$sl[1])\n    mk_tau <-sapply(mk, function(e) e[1]$tau[1])\n    results <-data.frame(substs_list, ts_coeffs, mk_tau, mk_pvalue)\n}\n\nplot_substs <- function(substs_list, graph_data, prefix){\n  lapply(substs_list, function(e){\n    data  <- graph_data[graph_data$site_node == e,]\n    file <-paste(prefix, e, \".png\", sep=\"\")\n    print (file)\n    png(filename = file)\n    print(data$radius)\n    plot(data$radius, data$density, type=\"l\")\n    dev.off()\n  })\n}\n\n#graph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_diff_rings_h3.csv\")\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_n2.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\n\nlist <- list_substs(graph_data, 3)\nresults <- kendall_stats(graph_data, list)\nbest_sites <- results[results$mk_pvalue < 0.05,]\n\nhist(results$ts_coeffs, seq(from = min(results$ts_coeffs), to = max(results$ts_coeffs)+0.0001, by = 0.00005))\nhist(results$mk_tau, seq(from = min(results$mk_tau), to = max(results$mk_tau)+0.0001, by = 0.00005))\n\nhist(best_sites$ts_coeffs, seq(from = min(best_sites$ts_coeffs), to = max(best_sites$ts_coeffs)+0.0001, by = 0.00005))\nhist(best_sites$mk_tau, seq(from = min(best_sites$mk_tau), to = max(best_sites$mk_tau)+0.0001, by = 0.00005))\n\nplots <-plot_substs(as.character(best_sites$substs_list), graph_data, \"n2_diff_rings_plot_\")\n\n#####\nh1_longliving <- c(\"4_INTNODE2429\",\"60_INTNODE2435\",\"73_INTNODE2425\",\"78_INTNODE2434\",\"85_INTNODE2434\",\"90_INTNODE2429\",\"111_INTNODE2428\",\"113_INTNODE2429\",\"138_INTNODE2416\",\"145_INTNODE2426\",\"151_INTNODE2425\",\"169_INTNODE2434\",\"171_INTNODE2429\",\"176_INTNODE2434\",\"178_INTNODE2426\",\"179_INTNODE2429\",\"184_INTNODE2429\",\"186_INTNODE2429\",\"201_INTNODE2434\",\"206_INTNODE2435\",\"238_INTNODE2422\",\"240_INTNODE2421\",\"261_INTNODE2435\",\"269_INTNODE2423\",\"292_INTNODE2433\",\"293_INTNODE2415\",\"311_INTNODE2423\",\"415_INTNODE2429\",\"470_INTNODE2428\",\"488_INTNODE2434\")\nplots <-plot_substs(as.character(h1_longliving), graph_data, \"h1_longliving_diff_rings_plot_\")\n\nh3_longliving <- c(\"495_INTNODE4258\",\"469_INTNODE4224\",\"315_INTNODE4207\",\"291_INTNODE4258\",\"276_INTNODE4232\",\"258_INTNODE4258\",\"233_INTNODE4230\",\"229_INTNODE4224\",\"206_INTNODE4200\",\"204_INTNODE4256\",\"189_INTNODE4224\",\"179_INTNODE4222\",\"176_INTNODE4231\",\"175_INTNODE4215\",\"173_INTNODE4200\",\"162_INTNODE4232\",\"159_INTNODE4230\",\"142_INTNODE4238\",\"138_INTNODE4257\",\"110_INTNODE4209\",\"98_INTNODE4207\",\"94_INTNODE4262\",\"79_INTNODE4239\",\"70_INTNODE4232\",\"69_INTNODE4232\",\"66_INTNODE4232\",\"47_INTNODE4266\",\"19_INTNODE4238\",\"18_INTNODE4224\",\"16_INTNODE4236\",\"15_INTNODE4236\",\"14_INTNODE4262\")\nplots <-plot_substs(as.character(h3_longliving), graph_data, \"h3_longliving_diff_rings_plot_\")\n\n## plot sites with significant LR for exponential and weibull model + signif kendall trends\n###\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_h3.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\nh3_best_likelihood<- c(\"19_INTNODE4238\", \"69_INTNODE4232\", \"66_INTNODE4232\", \"110_INTNODE4209\", \"15_INTNODE4236\", \"175_INTNODE4215\", \"19_INTNODE4238\", \"69_INTNODE4232\", \"241_INTNODE3838\", \"466_INTNODE4200\", \"66_INTNODE4232\", \"16_INTNODE4236\", \"110_INTNODE4209\", \"15_INTNODE4236\", \"278_INTNODE4195\", \"175_INTNODE4215\", \"202_INTNODE3930\", \"546_INTNODE3932\", \"70_INTNODE4232\", \"99_INTNODE4207\", \"233_INTNODE4230\", \"140_INTNODE4152\", \"174_INTNODE4127\", \"138_INTNODE4257\", \"209_INTNODE4241\", \"209_INTNODE4201\", \"153_INTNODE4102\", \"\", \"153_INTNODE4232\", \"\", \"218_INTNODE3933\", \"149_INTNODE4200\", \"149_INTNODE4230\", \"159_INTNODE4230\", \"19_INTNODE4238\", \"291_INTNODE4258\")\n#h3_big_p<- c(\"149_INTNODE4230\", \"160_INTNODE4257\", \"236_INTNODE2473\")\nplots <-plot_substs(as.character(h3_best_likelihood), graph_data, \"h3_plot_\")\n\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_h1.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\nh1_best_likelihood<- c(\"238_INTNODE2422\", \"205_INTNODE2406\", \"169_INTNODE2434\", \"169_INTNODE2394\", \"73_INTNODE2425\", \"151_INTNODE2425\", \"171_INTNODE2429\", \"202_INTNODE2406\", \"144_INTNODE2406\", \"155_INTNODE2428\", \"85_INTNODE2434\", \"111_INTNODE2428\", \"289_INTNODE2399\", \"113_INTNODE2429\" )\nplots <-plot_substs(as.character(h1_best_likelihood), graph_data, \"h1_plot_\")\n\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_n1.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\n#n1_best_likelihood<- c(\"250_INTNODE2456\", \"16_INTNODE2390\", \"222_INTNODE2391\", \"84_INTNODE2390\", \"86_INTNODE2384\", \"382_INTNODE2390\", \"248_INTNODE2479\", \"366_INTNODE2455\", \"382_INTNODE2390\", \"200_INTNODE2384\", \"332_INTNODE2384\", \"336_INTNODE2442\")\n#big aposteriori for big p\nn1_wood_likelihood<- c(\"336_INTNODE2442\",\"369_INTNODE2384\",\"388_INTNODE2384\",\"34_INTNODE2360\",\"250_INTNODE2390\",\"367_INTNODE2455\",\"369_INTNODE2383\",\"222_INTNODE2064\",\"222_INTNODE2390\",\"339_INTNODE2390\",\"434_INTNODE2391\",\"249_INTNODE3063\",\"248_INTNODE2473\",\"151_INTNODE1891\")\nplots <-plot_substs(as.character(n1_wood_likelihood), graph_data, \"n1_wood_plot_\")\n\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_n2.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\n#n2_best_likelihood<- c(\"466_INTNODE4636\", \"435_INTNODE4571\", \"197_INTNODE4596\", \"248_INTNODE4608\", \"329_INTNODE4636\", \"221_INTNODE4476\", \"26_INTNODE4675\", \"434_INTNODE4675\", \"199_INTNODE4587\", \"466_INTNODE4636\", \"367_INTNODE4582\", \"313_INTNODE4608\", \"331_INTNODE4582\", \"127_INTNODE4476\", \"435_INTNODE4571\", \"339_INTNODE3984\", \"197_INTNODE4596\", \"248_INTNODE4608\", \"329_INTNODE4636\", \"221_INTNODE4476\", \"249_INTNODE4367\", \"126_INTNODE4646\", \"347_INTNODE4637\")\n#big aposteriori for big p\nn2_wood_likelihood <- c(\"199_INTNODE4587\",\"248_INTNODE4608\",\"197_INTNODE4596\")\nplots <-plot_substs(as.character(n2_wood_likelihood), graph_data, \"n2_wood_plot_\")\n\n\n##\n\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_h3.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\nh3_chosen <- c(\"161_INTNODE3854\")\nplots <-plot_substs(as.character(h3_chosen), graph_data, \"h3_chosen_plot_\")\n",
    "created" : 1466182089698.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2687168",
    "id" : "170CAE6D",
    "lastKnownWriteTime" : 1467017539,
    "path" : "C:/Users/weidewind/workspace/RCoevolution/R/Kendall_stats.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}